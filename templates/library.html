<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿå ‚èœå“åº“</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter','Microsoft YaHei',Arial,sans-serif;background:#F3F4F6;min-height:100vh;padding:80px 20px 20px}
        .navbar{position:fixed;top:0;left:0;width:100%;background:rgba(255,255,255,0.95);padding:15px 30px;border-radius:0 0 15px 15px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 5px 15px rgba(0,0,0,0.1);z-index:1000;backdrop-filter:blur(10px)}
        .navbar a{color:#34D399;text-decoration:none;margin:0 15px;font-weight:700}
        .container{max-width:1200px;margin:0 auto}
        .filters{position:sticky;top:72px;background:#FFFFFF;border:2px solid #E5E7EB;border-radius:12px;padding:16px;z-index:500}
        .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px}
        .card{background:#FFFFFF;border:2px solid #E5E7EB;border-radius:12px;overflow:hidden}
        .thumb{height:120px;background:#F3F4F6}
        .content{padding:12px}
        .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;color:#FFFFFF;background:#F97316}
        .btn{padding:8px 12px;border:2px solid #34D399;color:#34D399;border-radius:10px;font-weight:700;background:transparent;cursor:pointer}
        .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:2000}
        .modal-card{background:#FFFFFF;border-radius:12px;padding:16px;max-width:640px;width:92%}
        @media (max-width:900px){ .grid{grid-template-columns:repeat(3,1fr)} }
        @media (max-width:600px){ .grid{grid-template-columns:repeat(2,1fr)} }
    </style>
</head>
<body>
    <div class="navbar">
        <div>
            <a href="/">ğŸ  é¦–é¡µ</a>
            <a href="/library">ğŸ“š èœå“åº“</a>
            <a href="/recommend">ğŸ’¡ ä¸ªæ€§åŒ–æ¨è</a>
            <a href="/pickup">âš–ï¸ å–é¤è¯†åˆ«</a>
        </div>
        <div>
            <span style="color:#374151">æ¬¢è¿, {{ user.username }}</span>
            <a href="/logout">ğŸšª é€€å‡º</a>
        </div>
    </div>

    <div class="container">
        <div class="filters">
            <div style="display:flex; gap:8px; align-items:center;">
                <input id="q" placeholder="æœç´¢èœå“åç§° / è¥å…»æ ‡ç­¾" style="flex:1; padding:10px 12px; border:2px solid #E5E7EB; border-radius:10px">
                <select id="cooking" style="padding:10px 12px; border:2px solid #E5E7EB; border-radius:10px">
                    <option value="">çƒ¹é¥ªæ–¹å¼</option>
                    <option>æ¸…è’¸</option>
                    <option>çº¢çƒ§</option>
                    <option>å‡‰æ‹Œ</option>
                </select>
                <button class="btn" onclick="load()">æœç´¢</button>
            </div>
        </div>

        <div class="grid" id="grid"></div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-card">
            <div id="modalContent"></div>
            <div style="text-align:right; margin-top:10px">
                <button class="btn" onclick="closeModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        async function load(page=1){
            const q = document.getElementById('q').value.trim();
            const cooking = document.getElementById('cooking').value;
            const url = `/api/dishes?q=${encodeURIComponent(q)}&cooking_method=${encodeURIComponent(cooking)}&page=${page}`;
            const res = await fetch(url);
            const {success, data} = await res.json();
            const grid = document.getElementById('grid');
            grid.innerHTML='';
            if(!success) return;
            data.forEach(d=>{
                const div = document.createElement('div');
                div.className='card';
                div.innerHTML = `<div class='thumb'></div>
                                 <div class='content'>
                                   <div style='display:flex; justify-content:space-between; align-items:center;'>
                                     <strong>${d.name}</strong>
                                     <span class='badge'>${d.tag}</span>
                                   </div>
                                   <div style='color:#6B7280; font-size:12px; margin-top:6px;'>${d.canteen||''} Â· ${d.cooking_method||''}</div>
                                   <div style='margin-top:8px; color:#374151'>${d.energy_kcal} kcal / é…æ–¹ ${d.recipe_weight_g}g</div>
                                   <div style='margin-top:8px; display:flex; gap:8px'>
                                     <button class='btn' onclick='detail(${JSON.stringify(d).replace(/"/g,"&quot;")})'>æŸ¥çœ‹è¯¦æƒ…</button>
                                   </div>
                                 </div>`;
                grid.appendChild(div);
            });
        }
        function detail(d){
            const html = `<h3 style='margin-bottom:8px;color:#111;font-weight:800'>${d.name}</h3>
                          <div style='color:#6B7280; font-size:12px;'>${d.canteen||''} Â· ${d.cooking_method||''}</div>
                          <div style='display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin-top:10px;'>
                            <div>èƒ½é‡ï¼š<strong>${d.energy_kcal}</strong> kcal</div>
                            <div>è›‹ç™½è´¨ï¼š<strong>${d.protein_g}</strong> g</div>
                            <div>è„‚è‚ªï¼š<strong>${d.fat_g}</strong> g</div>
                            <div>ç¢³æ°´ï¼š<strong>${d.carb_g}</strong> g</div>
                          </div>
                          <div style='margin-top:10px'>
                            <button class='btn'>åŠ å…¥é¤ç›˜</button>
                          </div>`;
            document.getElementById('modalContent').innerHTML = html;
            document.getElementById('modal').style.display='flex';
        }
        function closeModal(){ document.getElementById('modal').style.display='none'; }
        load();
    </script>
</body>
</html>
